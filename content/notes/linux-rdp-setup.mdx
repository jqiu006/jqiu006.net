---
slug: "linux-rdp-setup"
title: "Setting Up RDP (Remote Desktop) on Linux Systems"
date: "2025-03-28"
tags: ["Linux", "RDP", "Remote Desktop", "XRDP", "Kali Linux", "Remote Access"]
---

# Setting Up RDP (Remote Desktop) on Linux Systems

## Overview

This guide covers setting up Remote Desktop Protocol (RDP) access on Linux systems, with specific examples for Kali Linux. RDP allows graphical remote access to Linux desktops from Windows and other RDP clients.

## Prerequisites

- Linux system with desktop environment installed
- Administrative (root) access
- Network connectivity between client and server
- RDP client software (built into Windows, or third-party clients)

## Installation and Setup (Kali Linux Example)

### Step 1: Install XRDP

XRDP is the most common RDP server implementation for Linux:

```bash
apt install xrdp
```

### Step 2: Enable and Start XRDP Service

Configure XRDP to start automatically and start the service:

```bash
# Enable XRDP to start on boot
update-rc.d xrdp enable

# Start XRDP service
service xrdp start

# Check service status
service xrdp status
```

### Step 3: Verify Installation

Check that XRDP is running and listening on the correct port:

```bash
# Check if XRDP is listening on port 3389
netstat -tuln | grep 3389

# Check process status
ps aux | grep xrdp
```

## Firewall Configuration

### Open RDP Port

Most Linux distributions require explicit firewall configuration:

```bash
# For UFW (Ubuntu/Debian)
ufw allow 3389

# For iptables
iptables -A INPUT -p tcp --dport 3389 -j ACCEPT
iptables-save

# For firewalld (CentOS/RHEL/Fedora)
firewall-cmd --permanent --add-port=3389/tcp
firewall-cmd --reload
```

### Verify Port Access

Test that the RDP port is accessible:

```bash
# From local machine
telnet localhost 3389

# From remote machine
telnet [linux-server-ip] 3389
```

## Resolving Black Screen Issues

### Common Problem

After connecting via RDP, you may encounter a black screen instead of the desktop environment.

### Root Cause

The issue occurs when the Linux system doesn't properly initialize the desktop session for RDP connections, often due to missing environment variables or session configuration.

### Solution: Modify XRDP Startup Script

Edit the XRDP startup script to properly initialize the desktop environment:

```bash
sudo nano /etc/xrdp/startwm.sh
```

Add the following lines **before** the existing `if` statement:

```bash
unset DBUS_SESSION_BUS_ADDRESS
unset XDG_RUNTIME_DIR
. $HOME/.profile
```

### Complete Example Configuration

The modified `/etc/xrdp/startwm.sh` should look like this:

```bash
#!/bin/sh
# xrdp X session start script (c) 2015, 2017 mirabilos
# published under The MirOS Licence

# Ensure proper environment setup
unset DBUS_SESSION_BUS_ADDRESS
unset XDG_RUNTIME_DIR
. $HOME/.profile

if [ -r /etc/default/locale ]; then
  . /etc/default/locale
  export LANG LANGUAGE LC_ALL LC_COLLATE LC_CTYPE
fi

# Rest of the original script continues...
```

### Restart XRDP Service

After making changes, restart the XRDP service:

```bash
service xrdp restart
```

## Desktop Environment Considerations

### GNOME Desktop

For GNOME-based systems, you may need additional configuration:

```bash
# Install GNOME session manager
apt install gnome-session

# Configure XRDP to use GNOME
echo "gnome-session" > ~/.xsession
```

### XFCE Desktop

XFCE typically works better with XRDP:

```bash
# Install XFCE
apt install xfce4 xfce4-goodies

# Configure XRDP to use XFCE
echo "xfce4-session" > ~/.xsession
```

### KDE Plasma

For KDE environments:

```bash
# Install KDE
apt install kde-plasma-desktop

# Configure XRDP to use KDE
echo "startkde" > ~/.xsession
```

## User Configuration

### Create RDP User

For security, create a dedicated user for RDP access:

```bash
# Create new user
adduser rdpuser

# Add to necessary groups
usermod -aG sudo rdpuser  # If admin access needed
```

### Set User Session

Configure the desktop session for the user:

```bash
# Switch to the user
su - rdpuser

# Set preferred desktop environment
echo "xfce4-session" > ~/.xsession
# or
echo "gnome-session" > ~/.xsession
```

## Advanced Configuration

### Custom RDP Port

For security, consider changing the default RDP port:

```bash
# Edit XRDP configuration
nano /etc/xrdp/xrdp.ini

# Change port setting
port=3390  # Instead of default 3389
```

Update firewall rules accordingly:

```bash
ufw allow 3390
ufw deny 3389
```

### SSL/TLS Configuration

Enable encryption for RDP connections:

```bash
# Generate SSL certificate
openssl req -x509 -newkey rsa:2048 -nodes -keyout /etc/xrdp/key.pem -out /etc/xrdp/cert.pem -days 365

# Edit XRDP configuration
nano /etc/xrdp/xrdp.ini

# Add SSL settings
security_layer=tls
certificate=/etc/xrdp/cert.pem
key_file=/etc/xrdp/key.pem
```

### Session Management

Configure session limits and timeouts:

```bash
# Edit XRDP configuration
nano /etc/xrdp/xrdp.ini

# Add session settings
max_bpp=24
new_cursors=true
use_fastpath=both
```

## Testing RDP Connection

### From Windows

1. Open "Remote Desktop Connection" (mstsc)
2. Enter the Linux server IP address
3. Enter username and password
4. Connect to the session

### From Linux

```bash
# Install RDP client
apt install rdesktop

# Connect to RDP server
rdesktop [server-ip]:3389
```

### From macOS

Use Microsoft Remote Desktop app from the App Store or third-party clients like CoRD.

## Troubleshooting

### Common Issues and Solutions

#### Issue: Connection Refused

**Causes**:
- XRDP service not running
- Firewall blocking port 3389
- Wrong IP address

**Solutions**:
```bash
# Check service status
systemctl status xrdp

# Restart service
systemctl restart xrdp

# Check firewall
ufw status
```

#### Issue: Authentication Failed

**Causes**:
- Incorrect username/password
- User account locked
- PAM configuration issues

**Solutions**:
```bash
# Check user account
passwd -S username

# Reset password
passwd username

# Check PAM logs
tail -f /var/log/auth.log
```

#### Issue: Black Screen After Login

**Causes**:
- Desktop environment not properly configured
- Missing environment variables
- Session startup script issues

**Solutions**:
- Apply the startwm.sh fix described above
- Check ~/.xsession file
- Verify desktop environment installation

### Debug Mode

Run XRDP in debug mode for troubleshooting:

```bash
# Stop XRDP service
service xrdp stop

# Run in debug mode
xrdp --nodaemon --debug
```

### Log Analysis

Check XRDP logs for errors:

```bash
# XRDP logs
tail -f /var/log/xrdp.log
tail -f /var/log/xrdp-sesman.log

# System authentication logs
tail -f /var/log/auth.log
```

## Security Considerations

### Network Security

1. **Use VPN**: Access RDP through VPN when possible
2. **Firewall Rules**: Restrict RDP access to specific IP ranges
3. **Non-Standard Port**: Change default port 3389
4. **SSL/TLS**: Enable encryption for RDP traffic

### User Security

1. **Strong Passwords**: Enforce strong password policies
2. **Limited Users**: Only allow necessary users RDP access
3. **Session Timeouts**: Configure automatic session disconnection
4. **Audit Logging**: Monitor RDP connection attempts

### Example Firewall Rules

```bash
# Allow RDP only from specific subnet
iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 3389 -j ACCEPT
iptables -A INPUT -p tcp --dport 3389 -j DROP
```

## Performance Optimization

### Bandwidth Optimization

```bash
# Edit XRDP configuration for low bandwidth
nano /etc/xrdp/xrdp.ini

# Optimize settings
max_bpp=16
bitmap_cache=true
bitmap_compression=true
```

### Resource Management

```bash
# Limit concurrent sessions
nano /etc/xrdp/sesman.ini

# Set session limits
MaxSessions=10
KillDisconnected=true
DisconnectedTimeLimit=60
```

## Alternative Solutions

### VNC (Virtual Network Computing)

For environments where RDP doesn't work well:

```bash
# Install VNC server
apt install tightvncserver

# Start VNC server
vncserver :1

# Connect with VNC client
```

### X11 Forwarding

For command-line applications with GUI:

```bash
# SSH with X11 forwarding
ssh -X username@server-ip

# Run GUI applications
firefox &
```

## Related Resources

- [XRDP Official Documentation](http://xrdp.org/)
- [Ubuntu RDP Setup Guide](https://ubuntu.com/tutorials/ubuntu-desktop-rdp)
- [Remote Desktop Security Best Practices](https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/rds-plan-secure-data-storage)
- [Linux Desktop Environment Comparison](https://itsfoss.com/best-linux-desktop-environments/)
